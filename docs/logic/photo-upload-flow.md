# 写真投稿処理フロー・業務ロジック詳細

## 概要
ユーザーが写真を投稿する際の一連の処理フローと、業務ロジックの詳細を記載します。

---

## 1. 入力受付
- ユーザーは「写真投稿画面」から画像ファイル・カテゴリを選択し、投稿ボタンを押下
- バックエンドAPI（`POST /api/pictures`）にリクエスト送信

## 2. バリデーション
- ファイル形式（JPEG/PNG/GIF/WEBP/HEIC/HEIF）・サイズ（20MB以下）をサーバー側で検証
- カテゴリIDの存在チェック
- 不正な場合はエラー応答

## 3. 画像変換・保存
- HEIC/HEIFの場合はPNGに自動変換
- EXIFの位置情報を削除、向きを自動補正
- サムネイル（長辺1280px/320px）を生成
- 外付けSSD（`/mnt/photos`）に原本・サムネイルを保存

## 4. DB登録
- Picturesテーブルに新規レコードを作成
  - image_path, user_id, category_id, create_date等を保存
- OperationLogsに「CREATE picture」操作を記録

## 5. レスポンス
- 正常時：新規画像のID・パス等を返却
- 異常時：エラーメッセージ返却

---

## 業務ルール
- 1投稿につき1枚のみ（将来拡張で複数対応）
- カテゴリは必須
- 投稿後は一覧画面へリダイレクト
- 投稿画像は論理削除（is_deleted）で管理
- 投稿失敗時はファイル・DBロールバック

---

他の処理フローもご要望に応じて作成可能です。
