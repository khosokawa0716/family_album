# Architecture Choices & Decision Points

本システムの設計・運用に関して、将来アップデートや運用拡張を見据えた「考えるべきポイント」と「代表的な解決方法の選択肢」を整理します。  
（現時点で決めなくてもOK。必要に応じて参照するためのカタログです）

---

## 1. 画像保存先（Docker × 外付けSSD）

### ● 考えるポイント
- Dockerから外付けSSDへ安全にアクセスする方法
- Raspberry Pi再起動時・SSD抜き差し時の挙動
- バックアップや移行の容易さ

### ● 代表的な解決パターン

| パターン | 内容 | メリット | デメリット |
|---|---|---|---|
| A | PiのホストOSで `/mnt/photos` にSSDをマウントし、Dockerコンテナにボリュームとして渡す | 標準的。Docker再起動でもデータ消えない | マウント失敗時にアプリが画像保存できなくなる。SSDの抜き差し要注意 |
| B | Docker内部で直接マウント（非推奨） | セットアップ簡単 | トラブル時の対応が難しい。推奨されない |

#### → **まずはAで運用、トラブル時の運用手順をメモしておけばOK**

---

## 2. LAN内運用時のセキュリティ

### ● 考えるポイント
- 家族以外がWi-Fiに入った場合、アクセスできてしまうリスク
- HTTPS対応の有無（暗号化）

### ● 代表的な解決パターン

| パターン | 内容 | メリット | デメリット |
|---|---|---|---|
| A | HTTPのみ（LAN内限定） | 設定が簡単 | 万が一外部からアクセスされると危険 |
| B | HTTPS化（自己署名証明書） | 通信内容の盗聴防止 | セットアップがやや難しい |
| C | VPN越しアクセスのみ | 高セキュリティ | 導入・運用ハードル高い |

#### → **初期はA（HTTP、LAN限定）で十分。  
将来VPNやHTTPS化も検討できるよう、Nginxリバースプロキシ運用推奨。**

---

## 3. バックアップ運用

### ● 考えるポイント
- どこまで自動化するか（手動 or シェルスクリプト or cron）
- バックアップ失敗時に気付けるか

### ● 代表的な解決パターン

| パターン | 内容 | メリット | デメリット |
|---|---|---|---|
| A | 手動rsync | シンプル | 忘れやすい |
| B | cronで自動rsync | 手間いらず | 失敗時に気付きづらい |
| C | バックアップ時にメールや通知 | 失敗時の安心感 | 実装がやや面倒 |

#### → **最初はAやBで十分。失敗検知は余裕ができたらでもOK。  
「バックアップ手順と復元手順」をdocs/にメモしておくと安心。**

---

## 4. ユーザー招待・管理UI

### ● 考えるポイント
- 招待コードの有効期間・一意性
- 招待後のアカウント有効化フロー（自動/手動）

### ● 代表的な解決パターン

| パターン | 内容 | メリット | デメリット |
|---|---|---|---|
| A | 管理者が手動でユーザー作成 | シンプル | 手間がかかる |
| B | 招待コード発行・URL化 | 自動化できる | 実装がやや難しい |
| C | 有効期限付き招待コード | セキュリティ高い | 実装追加が必要 |

#### → **家族だけならAや簡易なBでまず運用し、必要なら後日拡張。**

---

## 5. ストレージ残量監視・通知

### ● 考えるポイント
- どこで残量をチェックするか
- アラート（通知）は必要か？

### ● 代表的な解決パターン

| パターン | 内容 | メリット | デメリット |
|---|---|---|---|
| A | `/settings`で残量表示のみ | 実装が簡単 | 見に行かないと気付けない |
| B | 一定値以下で画面に警告表示 | わかりやすい | 実装やや追加 |
| C | メールやLINE通知 | 外出先でも気付ける | 実装・運用ハードル高め |

#### → **AまたはBで十分。通知は将来拡張でもOK。**

---

## 6. 画像変換・EXIF除去のパフォーマンス

### ● 考えるポイント
- 複数同時アップロード時の処理能力
- 画像サイズ制限の設定

### ● 代表的な解決パターン

| パターン | 内容 | メリット | デメリット |
|---|---|---|---|
| A | アップロードサイズ制限（例：20MB） | Piの負荷を管理できる | ユーザー体験に影響する可能性 |
| B | 画像変換処理を順番待ちキュー化 | 安定運用 | 実装がやや難しめ |
| C | 高負荷時は一時的にアップロード制限 | Piを守れる | ユーザー制限がかかる |

#### → **A（制限設定）でまず運用し、パフォーマンスが問題になればBやCを検討すればOK。**

---

## 備考

- どの選択肢も「最初はシンプルに」「必要になったら拡張」で進めるのが現実的です。
- 迷ったらこのカタログを参照し、選択理由・運用方針をREADMEや設計メモに記載しておくとスムーズです。
